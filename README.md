# CSV文字変換CLIツール

CSVファイルの指定した列に対して、文字変換表を使用して文字単位での変換を行うコマンドラインツールです。

## 概要

このツールは、CSV形式のデータファイル内の特定の列に対して、あらかじめ定義された変換表に基づいて文字を一対一で変換します。主に繁体字中国語の文字変換や、特定の文字セット間での変換作業に使用されることを想定しています。

## 主な機能

- **柔軟なエンコーディング対応**: UTF-8をはじめとする様々な文字エンコーディングに対応
- **列指定変換**: CSVファイルの任意の列のみを変換対象に指定可能
- **ヘッダー行処理**: ヘッダー行の有無を設定可能（入力・出力で個別設定）
- **エラーハンドリング**: 変換表にない文字の処理方法を選択可能
- **詳細ログ**: 処理状況と結果を詳細にログ出力
- **設定駆動**: JSON設定ファイルによる柔軟な処理設定

## インストール

```bash
# 依存関係のインストール
npm install

# プロジェクトのビルド
npm run build
```

## 使用方法

### 基本的な使用方法

```bash
# デフォルトの設定ファイル (config.json) を使用
npm start

# 設定ファイルを指定
npm start -- --config my-config.json

# デバッグモードで実行
npm start -- --config config.json --verbose
```

### 開発モード

```bash
# TypeScriptファイルを直接実行（開発時）
npm run dev
```

## 設定ファイル

設定はJSON形式のファイルで指定します。以下は設定例です：

```json
{
  "conversion": {
    "input": {
      "path": "sample/input.csv",
      "encoding": "utf8",
      "lineBreak": "lf",
      "quote": "\"",
      "hasHeader": true
    },
    "output": {
      "path": "sample/output.csv", 
      "encoding": "utf8",
      "lineBreak": "lf",
      "quote": "\"",
      "hasHeader": true
    },
    "conversionTable": "sample/conversion.csv",
    "targetColumns": [1, 2],
    "missingCharacterHandling": "warn"
  },
  "logging": {
    "level": "info",
    "output": "console"
  }
}
```

### 設定項目詳細

#### conversion
- **input**: 入力ファイルの設定
  - `path`: 入力CSVファイルのパス
  - `encoding`: ファイルエンコーディング（utf8, shift_jis, etc.）
  - `lineBreak`: 改行コード（lf, crlf, cr）
  - `quote`: クォート文字
  - `hasHeader`: ヘッダー行の有無
- **output**: 出力ファイルの設定（inputと同様の項目）
- **conversionTable**: 文字変換表CSVファイルのパス
- **targetColumns**: 変換対象の列番号配列（0から開始）
- **missingCharacterHandling**: 変換表にない文字の処理方法
  - `error`: エラーで停止
  - `skip`: 変換をスキップ
  - `warn`: 警告を出力して継続

#### logging
- **level**: ログレベル（error, warn, info, debug）
- **output**: ログ出力先（console, file）
- **logFile**: ファイル出力時のログファイルパス（省略可）

## 文字変換表の形式

文字変換表はCSV形式で、以下のフォーマットで作成します：

```csv
変換前文字,変換後文字
龍,龙
鳳,凤
車,车
```

- ヘッダー行は不要
- 1行目：変換前の文字
- 2行目：変換後の文字

## サンプルファイル

`sample/`ディレクトリに以下のファイルが含まれています：

- `input.csv`: サンプル入力ファイル
- `conversion.csv`: サンプル変換表
- `output.csv`: 期待される出力結果
- `config.json`: 基本設定ファイル

## ログ出力例

```
=================================================================
CSV文字変換処理を開始します
処理開始時刻: 2025-08-28T10:00:00.000Z
=================================================================
入力ファイルパス: /path/to/input.csv
出力ファイルパス: /path/to/output.csv
変換表ファイルパス: /path/to/conversion.csv
対象列番号: [1, 2] (0から開始)
入力ファイルエンコーディング: utf8
出力ファイルエンコーディング: utf8
入力ファイルヘッダー: あり
出力ファイルヘッダー: あり
文字変換表にない文字の処理方式: warn
-----------------------------------------------------------------
変換ルール数: 100件
処理対象データ行数: 500行 (2行目～501行目)
-----------------------------------------------------------------
処理中... 1000行完了
-----------------------------------------------------------------
データ行処理完了: 全500行を処理
出力ファイル書き込み完了: 501行出力
=================================================================
【処理結果レポート】
処理完了時刻: 2025-08-28T10:01:00.000Z
処理ステータス: 正常完了
入力ファイル: /path/to/input.csv (501行)
出力ファイル: /path/to/output.csv (501行)
処理データ行数: 500行
文字変換ルール適用数: 100件
対象列: [1, 2]
✅ CSV文字変換処理が正常に完了しました
=================================================================
```

## 技術スタック

- **言語**: TypeScript
- **ランタイム**: Node.js
- **ビルドツール**: esbuild
- **依存関係**:
  - `csv-parse`: CSV解析
  - `csv-stringify`: CSV生成
  - `iconv-lite`: 文字エンコーディング変換
  - `winston`: ログ処理
  - `yargs`: コマンドライン引数解析

## ライセンス

ISC

## 開発

このプロジェクトの開発に関する詳細は、`CLAUDE.md`を参照してください。